\chapter{Оптимизация преобразований базисов}
\addcontentsline{toc}{chapter}{Оптимизация преобразований базисов}
\section{О комбинированном использовании полиномиального и нормального базисов}

Программные реализации умножения в нормальных базисах оказались медленнее алгоритмов умножения в стандартных базисах
даже в полях небольших размерностей. Сравнение двух типов базисов, стандартного и нормального, наводит на мысль об ускорении арифметики в конечных полях
за счет использования выгодных сторон каждого из них. Действительно, умножение быстрее производить в стандартном представлении поля $GF(2^n)$, а возведение
в степень - в нормальном представлении.

Для реализации этой идеи понадобятся матрицы перехода от нормального базиса к стандартному и обратно, которые могут оказаться не разряженными, 
а плотными, и тогда сложность перехода от одного базиса к другому в худшем случае будет $O(n^2/log n)$(если использовать для умножения матрицы на вектор
метод "четырех русских").

Но в удачном случае сложность перехода может оказаться даже не выше линейной, например в случае, если число ненулевых элементов в матрицах переходов будет
$O(n)$. Таким образом, возникает задача поиска нормальных базисов с "простыми" матрицами переходов к стандартным базисам и обратно.

Эта задача легко решается в случае оптимальных нормальных базисов первого типа. 
\begin{Theorem}
Переход от стандартного базиса поля $GF(q^n)$ к соответствующему(с тем же генератором) оптимальному нормальному базису первого типа(если, конечно, он 
существует для данного $n$) и обратно можно выполнить с линейной сложностью.
\end{Theorem}
\begin{proof}
Легко видеть, что в этом случае базис $\{\zeta,...,\zeta^n\}$(не совсем стандартный) совпадает с точностью до перестановки с оптимальным 
нормальным базисом
$$\{\zeta,\zeta^q,\zeta^{q^2},\zeta^{q^{n-1}}\},$$
так как последовательность чисел $1, q, q^2, ..., q^{n-1}$, вычисленных по модулю $p$, совпадает с некоторой перестановкой
$$\{1,2,...,n\}$$
в силу того, что $\zeta$ есть примитивный корень $p-й$ степени из единицы в поле $GF(q^n)$, а $q$ - примитивный корень $p$-й степени из единицы в поле 
$GF(q^n)$, а $q$ - примитивный корень по модулю $p$. 

Поэтому, очевидно, переход от базиса $\{\zeta,...,\zeta^n\}$ к нормальному базису 
$$\{\zeta,\zeta^q,\zeta^{q^2},\zeta^{q^{n-1}}\}$$
и обратно выполняется с оценкой сложности не более чем $n$.

Отметим попутно, что $\zeta$ является корнем неприводимого над полем $GF(q)$ многочлена
$$1+X+...+X^n=\frac{X^p-1}{X-1}$$
Стандартным базисом для перехода будет базис $\{1,\zeta,...,\zeta^{n-1}\}$. Очевидно, он с линейной сложностью выражается через базис
$\{\zeta,...,\zeta^n\}$, поскольку 
$$\zeta^n=1+\zeta+...+\zeta^{n-1},$$
и обратно, базис $\{\zeta,...,\zeta^n\}$, благодаря формуле
$$1=\zeta+...+\zeta^{n-1}+\zeta^n,$$
с линейной сложностью выражается через базис $\{1,\zeta,...,\zeta^{n-1}\}$. В результате имеем, что переход от
оптималього нормального базиса 
$$\{\zeta,\zeta^q,\zeta^{q^2},...,\zeta^{q^{n-1}}\}$$
к стандартному базису $\{1,\zeta,...,\zeta^{n-1}\}$ и обратно выполняется с линейной сложностью.
\end{proof}

\section{Оценка сложности перехода от оптимальных нормальных базисов второго и третьего типа к стандартным и обратно}

Вначале докажем несколько вспомогательных утверждений (следующая лемма выполняется и для общего случая).
Пусть $x=\alpha_1$ - генератор оптимального нормального базиса
$$\{\alpha_1,...,\alpha_n\}$$
второго типа поля $GF(q^n)$, он же генератор соответствующего стандартного базиса $\{x^0,...,x^{n-1}\}$, т.е. $\alpha_1=x^{q^{k-1}}=\zeta^{q^{k-1}}+\zeta^{-q^{k-1}},$
и при любом $k \le n$
$$\alpha_k = x^{q^{k-1}}= \zeta^{q^{k-1}}+\zeta^{-q^{k-1}},$$
где $\zeta$ - примитивный корень из 1 степени $p=2n+1$ в поле $GF(q^{2n})$.

Рассмотрим вспомогательную последовательность $a_0, a_1,...,$ порожденную элементом $x$. Положим $a_0 = 2$ (в случае $p=2$, $a_0=0$) и, далее, 
$a_k=\zeta^k + \zeta^{-k}, k=1,2,..., a_1=\alpha_1$.

Элементы $a_1, a_2,...,a_n$ этой последовательности образуют почти нормальный базис, являющийся перестановкой элментов нормального базиса.

\begin{Lemma}
Для любого $k \ge 1$ имеют место следующие рекуррентные соотношения:
\\~~1. $a_{k+1}=a_ka_1 - a_{k-1}$
\\~~2. $a_{p^k}= x^{p^k}$.
\\~~3. $a_{p^k+i}=a_ix^{p^k}-a_{p^k-i}.$
\end{Lemma}
\begin{proof}
Для доказательства первой формулы заметим, что
$$(\zeta^k+\zeta^{-k})(\zeta+\zeta^{-1})=\zeta^{k-1}+\zeta^{-k+1}+\zeta^{k+1}+\zeta^{-k-1},$$
т.е. $a_ka_1-a_{k-1}=a_{k+1}.$

Вторая формула очевидна.

Третья формула проверяется непосредственно:
\begin{align}
a_{p^k+i}=\zeta^{p^k+i}+\zeta^{-p^k-i}=(\zeta^{p^k}+\zeta^{-p^k})(\zeta^i+\zeta^-i)-(\zeta^{p^k-i}+\zeta^{-p^k+i})=\nonumber\\
=a_{p^k}a_i-a_{p^k-i}=x^{p^k}a_i-a_{p^k-i}.\nonumber
\end{align}
\end{proof}

Рекуррентные соотношения, доказанные в лемме, позволяют записать формулы перехода от почти стандартного базиса $\{x^1,...,x^n\}$ к почти нормальному
базису.

В случае $p=2$ вычитание в лемме можно заменить на сложение.

Из леммы следует, что для любого $i \ge 1$ элемент $a_i$ почти нормального базиса $\alpha_i$ выражается в виде значения некоторого многочлена степени 
$i$ над полем $GF(q)$, т.е.
$$a_i=f_i(x)=\sum_{j=1}^{i}f_{i,j}x^j.$$

Выразив таким образом все элементы $a_i$ почти нормального базиса в почти стандартном базисе, получим матрицу перехода $F_n=(f_{i,j})$ от почти стандартного
базиса к почти нормальному. В случае, когда $p=2$ плотность $S(F_n)$(количество ненулевых элементов) матрицы $F_n$ оценивается следующим образом:

\begin{Theorem}
Плотность матрицы перехода от почти стандартного базиса поля $GF(2^n)$ к почти нормальному базису второго или третьего типа равна $O(n^{\log_23})$.
\end{Theorem}

Из этой теоремы видно, что матрица перехода является разряженной, и это позволяет осуществлять быстрое умножение в этом базисе. Приведем доказательство
этой теоремы.
\begin{proof}
Согласно формулам предыдущей леммы, матрица $F_{2n+1}$, построенная с их помощью, имеет при $n=2^k-1$ вид:
\begin{equation}
F_{2n+1}=
\left(
\begin{matrix}
  	F_n   & o_n & O_n \\
  	0...0 & 1   & 0...0 \\
	G_n   & o_n & F_n \\
\end{matrix}
\right)
\end{equation}
где $o_n$ - нулевой вектор-столбец высоты $n$, $O_n$ - нулевая $n \times n$ матрица, матрица $G_n$ есть симметрическое отражение матрицы $F_n$ относительно
средней строки, т.е. $G_n = I_n F_n$, где $I_n = (\delta_{i, n-i+1})$ - матрица с единицами на побочной диагонали и нулями в остальных местах. 
Например, матрица $F_7$ выглядит так:
\begin{equation}
F_7=
\left(
\begin{matrix}
  	1 & 0 & 0 & 0 & 0 & 0 & 0 \\
  	0 & 1 & 0 & 0 & 0 & 0 & 0 \\
	1 & 0 & 1 & 0 & 0 & 0 & 0 \\
	0 & 0 & 0 & 1 & 0 & 0 & 0 \\
	1 & 0 & 1 & 0 & 1 & 0 & 0 \\
	0 & 1 & 0 & 0 & 0 & 1 & 0 \\                                           
	1 & 0 & 0 & 0 & 1 & 0 & 1 \\
\end{matrix}
\right)
\end{equation}

Если разбить матрицу на 4 квадратных подматрицы, удалив среднюю строку и средний столбец, получим, что левый верхний квадрат $3 \times 3$ симметричен 
относительно горизонтали левому нижнему и равен нижнему правому квадрату. Средняя строка и средний столбец содержат ровно одну единицу, лежащую на их 
пересечении. Матрица является нижнетреугольной с единицами на главной диагонали. Действительно, в общем случае согласно предыдущей лемме, при 
$0 \le i \le 2^k$
$$\sum_{j=1}^{2^k+i}f_{2^k+i,j}x^j=a_{2^k+i}=a_ix^{2^k}+a_{2^k-i}=\sum_{j=1}^{i}f_{i,j}x^{2^k+j}+\sum_{j=1}^{2^k-i}f_{2^k-i,j}x^j,$$
откуда имеем $f_{2^k+i,j}=f_{2^k-i,j},$ при $0 \le j \le 2^k$, и $f_{2^k+i,2^k+j}=f_{i,j}$ при $1 \le j \le 2^k$.

Опираясь на это представление, можно получить следующую рекуррентную формулу для вычисления плотности последовательности матриц $F_n$
$$S(F_{2n+1})=3S(F_n)+1, n \ge 3, S(F_3)=4,$$
из которой вытекает рекуррентная формула
$$S(F_{2^k-1})=3S(F_{2^{k-1}-1})+1, k \ge 2, S(F_3)=4.$$

Полагая $l(k) = S(F_{2^k-1}),$ перейдем к линейному рекуррентному соотношению $l(k)=3l(k-1)+1, l(2)=4$, решением которого будет
$l(k)=(3^k-1)/2.$ Обозначив $n=2^k-1$ и выразив $3^k=(2^k)^{\log_23}=(n+1)^{\log_23},$ получим, что
$$S(F_n)=l(k)=\frac{(n+1)^{\log_23}-1}{2}=O(n^{log_23})$$

В общем случае равенство $S(F_n)=O(n^{\log_23})$ сохраняется, так как выбрав $k$ таким образом, что $2^k-1 < n \le 2^{k+1}-1$, можно заметить, что матрица
$F_n$ является главной подматрицей матрицы $F_m$, $m=2^k-1$, откуда имеем
$$S(F_n)\le S(F_m)=O(m^{log_23})=O(n^{\log_23}).$$
Аналогично можно оценить плотность матрицы $F_n'=F_n\cdot B_n$, и непосредственно проверяется, что в матрице $B_n$ все элементы нулевые, кроме элементов
$b_{i,i+1}=1$ над диагональю и некоторых элементов нижней строки $b_{n,j}$ и справедливы следующие равенства для элементов матрицы $F_n':$
$$f_{i,1}'=f_{i,n}b_{n,1}=\delta_{i,n}b_{n,1}, f_{i,j}'=f_{i,j-1}+f_{i,n}b_{n,j}=f_{i,j-1}+\delta_{i,n}b_{n,j},$$
так как в силу того, что матрица $F_n$ нижнетреугольная, для ее элементов имеем $f_{i,n}=\delta_{i,n}$, где $\delta_{i,n}$ - дельта-символ Кронекера. 
Складывая эти равенства, получим, что
$$S(F_n')=\sum_{i=1,j=1}^{n,n-1}f_{i,j}+\sum_{j=1}^{n}b_{n,j}=S(F_n)-1+\sum_{j=1}^{n}b_{n,j}\le S(F_n)-1+n=O(n^{\log_23}).$$

Обозначим через $L(F_n)$ сложность линейного преобразования, определяемого матрицей $F_n$ (в данном случае - это наименьшее число операций сложения по 
модулю два, необходимых для вычисления этого преобразования).

\end{proof}      