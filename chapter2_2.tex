\section{Оптимизация преобразований базисов}
\subsection{О комбинированном использовании полиномиального и нормального базисов}

Программные реализации умножения в нормальных базисах оказались медленнее алгоритмов умножения в стандартных базисах
даже в полях небольших размерностей. Сравнение двух типов базисов, стандартного и нормального, наводит на мысль об ускорении арифметики в конечных полях
за счет использования выгодных сторон каждого из них. Действительно, умножение быстрее производить в стандартном представлении поля $GF(2^n)$, а возведение
в степень - в нормальном представлении.

Для реализации этой идеи понадобятся матрицы перехода от нормального базиса к стандартному и обратно, которые могут оказаться не разряженными, 
а плотными, и тогда сложность перехода от одного базиса к другому в худшем случае будет $O(n^2/log n)$(если использовать для умножения матрицы на вектор
метод "четырех русских").

Но в удачном случае сложность перехода может оказаться даже не выше линейной, например в случае, если число ненулевых элементов в матрицах переходов будет
$O(n)$. Таким образом, возникает задача поиска нормальных базисов с "простыми" матрицами переходов к стандартным базисам и обратно.

Эта задача легко решается в случае оптимальных нормальных базисов первого типа. 
\begin{Theorem}
Переход от стандартного базиса поля $GF(q^n)$ к соответствующему(с тем же генератором) оптимальному нормальному базису первого типа(если, конечно, он 
существует для данного $n$) и обратно можно выполнить с линейной сложностью.
\end{Theorem}
\begin{proof}
Легко видеть, что в этом случае базис $\{\zeta,...,\zeta^n\}$(не совсем стандартный) совпадает с точностью до перестановки с оптимальным 
нормальным базисом
$$\{\zeta,\zeta^q,\zeta^{q^2},\zeta^{q^{n-1}}\},$$
так как последовательность чисел $1, q, q^2, ..., q^{n-1}$, вычисленных по модулю $p$, совпадает с некоторой перестановкой
$$\{1,2,...,n\}$$
в силу того, что $\zeta$ есть примитивный корень $p-й$ степени из единицы в поле $GF(q^n)$, а $q$ - примитивный корень $p$-й степени из единицы в поле 
$GF(q^n)$, а $q$ - примитивный корень по модулю $p$. 

Поэтому, очевидно, переход от базиса $\{\zeta,...,\zeta^n\}$ к нормальному базису 
$$\{\zeta,\zeta^q,\zeta^{q^2},\zeta^{q^{n-1}}\}$$
и обратно выполняется с оценкой сложности не более чем $n$.

Отметим попутно, что $\zeta$ является корнем неприводимого над полем $GF(q)$ многочлена
$$1+X+...+X^n=\frac{X^p-1}{X-1}$$
Стандартным базисом для перехода будет базис $\{1,\zeta,...,\zeta^{n-1}\}$. Очевидно, он с линейной сложностью выражается через базис
$\{\zeta,...,\zeta^n\}$, поскольку 
$$\zeta^n=1+\zeta+...+\zeta^{n-1},$$
и обратно, базис $\{\zeta,...,\zeta^n\}$, благодаря формуле
$$1=\zeta+...+\zeta^{n-1}+\zeta^n,$$
с линейной сложностью выражается через базис $\{1,\zeta,...,\zeta^{n-1}\}$. В результате имеем, что переход от
оптимального нормального базиса 
$$\{\zeta,\zeta^q,\zeta^{q^2},...,\zeta^{q^{n-1}}\}$$
к стандартному базису $\{1,\zeta,...,\zeta^{n-1}\}$ и обратно выполняется с линейной сложностью.
\end{proof}

\subsection{Оценка сложности перехода от оптимальных нормальных базисов второго и третьего типа к стандартным и обратно}

Вначале докажем несколько вспомогательных утверждений (следующая лемма выполняется и для общего случая).
Пусть $x=\alpha_1$ - генератор оптимального нормального базиса
$$\{\alpha_1,...,\alpha_n\}$$
второго типа поля $GF(q^n)$, он же генератор соответствующего стандартного базиса $\{x^0,...,x^{n-1}\}$, т.е. $\alpha_1=x^{q^{k-1}}=\zeta^{q^{k-1}}+\zeta^{-q^{k-1}},$
и при любом $k \le n$
$$\alpha_k = x^{q^{k-1}}= \zeta^{q^{k-1}}+\zeta^{-q^{k-1}},$$
где $\zeta$ - примитивный корень из 1 степени $p=2n+1$ в поле $GF(q^{2n})$.

Рассмотрим вспомогательную последовательность $a_0, a_1,...,$ порожденную элементом $x$. Положим $a_0 = 2$ (в случае $p=2$, $a_0=0$) и, далее, 
$a_k=\zeta^k + \zeta^{-k}, k=1,2,..., a_1=\alpha_1$.

Элементы $a_1, a_2,...,a_n$ этой последовательности образуют почти нормальный базис, являющийся перестановкой элментов нормального базиса.

\begin{Lemma}\label{lemma}
Для любого $k \ge 1$ имеют место следующие рекуррентные соотношения:
\\~~1. $a_{k+1}=a_ka_1 - a_{k-1}$
\\~~2. $a_{p^k}= x^{p^k}$.
\\~~3. $a_{p^k+i}=a_ix^{p^k}-a_{p^k-i}.$
\end{Lemma}
\begin{proof}
Для доказательства первой формулы заметим, что
$$(\zeta^k+\zeta^{-k})(\zeta+\zeta^{-1})=\zeta^{k-1}+\zeta^{-k+1}+\zeta^{k+1}+\zeta^{-k-1},$$
т.е. $a_ka_1-a_{k-1}=a_{k+1}.$

Вторая формула очевидна.

Третья формула проверяется непосредственно:
\begin{align}
a_{p^k+i}=\zeta^{p^k+i}+\zeta^{-p^k-i}=(\zeta^{p^k}+\zeta^{-p^k})(\zeta^i+\zeta^-i)-(\zeta^{p^k-i}+\zeta^{-p^k+i})=\nonumber\\
=a_{p^k}a_i-a_{p^k-i}=x^{p^k}a_i-a_{p^k-i}.\nonumber
\end{align}
\end{proof}

Рекуррентные соотношения, доказанные в лемме, позволяют записать формулы перехода от почти стандартного базиса $\{x^1,...,x^n\}$ к почти нормальному
базису.

В случае $p=2$ вычитание в лемме можно заменить на сложение.

Из леммы следует, что для любого $i \ge 1$ элемент $a_i$ почти нормального базиса $\alpha_i$ выражается в виде значения некоторого многочлена степени 
$i$ над полем $GF(q)$, т.е.
$$a_i=f_i(x)=\sum_{j=1}^{i}f_{i,j}x^j.$$

Выразив таким образом все элементы $a_i$ почти нормального базиса в почти стандартном базисе, получим матрицу перехода $F_n=(f_{i,j})$ от почти стандартного
базиса к почти нормальному. В случае, когда $p=2$ плотность $S(F_n)$(количество ненулевых элементов) матрицы $F_n$ оценивается следующим образом:

\begin{Theorem}\label{logn3}
Плотность матрицы перехода от почти стандартного базиса поля $GF(2^n)$ к почти нормальному базису второго или третьего типа равна $O(n^{\log_23})$.
\end{Theorem}

Из этой теоремы видно, что матрица перехода является разряженной, и это позволяет осуществлять быстрое умножение в этом базисе. Приведем доказательство
этой теоремы.
\begin{proof}
Согласно формулам предыдущей леммы (\ref{lemma}), матрица $F_{2n+1}$, построенная с их помощью, имеет при $n=2^k-1$ вид:
\begin{equation}
F_{2n+1}=
\left(
\begin{matrix}
  	F_n   & o_n & O_n \\
  	0...0 & 1   & 0...0 \\
	G_n   & o_n & F_n \\
\end{matrix}
\right)
\end{equation}
где $o_n$ - нулевой вектор-столбец высоты $n$, $O_n$ - нулевая $n \times n$ матрица, матрица $G_n$ есть симметрическое отражение матрицы $F_n$ относительно
средней строки, т.е. $G_n = I_n F_n$, где $I_n = (\delta_{i, n-i+1})$ - матрица с единицами на побочной диагонали и нулями в остальных местах. 
Например, матрица $F_7$ выглядит так:
\begin{equation}
F_7=
\left(
\begin{matrix}
  	1 & 0 & 0 & 0 & 0 & 0 & 0 \\
  	0 & 1 & 0 & 0 & 0 & 0 & 0 \\
	1 & 0 & 1 & 0 & 0 & 0 & 0 \\
	0 & 0 & 0 & 1 & 0 & 0 & 0 \\
	1 & 0 & 1 & 0 & 1 & 0 & 0 \\
	0 & 1 & 0 & 0 & 0 & 1 & 0 \\                                           
	1 & 0 & 0 & 0 & 1 & 0 & 1 \\
\end{matrix}
\right)
\end{equation}

Если разбить матрицу на 4 квадратных подматрицы, удалив среднюю строку и средний столбец, получим, что левый верхний квадрат $3 \times 3$ симметричен 
относительно горизонтали левому нижнему и равен нижнему правому квадрату. Средняя строка и средний столбец содержат ровно одну единицу, лежащую на их 
пересечении. Матрица является нижнетреугольной с единицами на главной диагонали. Действительно, в общем случае согласно лемме (\ref{lemma}), при 
$0 \le i \le 2^k$
$$\sum_{j=1}^{2^k+i}f_{2^k+i,j}x^j=a_{2^k+i}=a_ix^{2^k}+a_{2^k-i}=\sum_{j=1}^{i}f_{i,j}x^{2^k+j}+\sum_{j=1}^{2^k-i}f_{2^k-i,j}x^j,$$
откуда имеем $f_{2^k+i,j}=f_{2^k-i,j},$ при $0 \le j \le 2^k$, и $f_{2^k+i,2^k+j}=f_{i,j}$ при $1 \le j \le 2^k$.

Опираясь на это представление, можно получить следующую рекуррентную формулу для вычисления плотности последовательности матриц $F_n$
$$S(F_{2n+1})=3S(F_n)+1, n \ge 3, S(F_3)=4,$$
из которой вытекает рекуррентная формула
$$S(F_{2^k-1})=3S(F_{2^{k-1}-1})+1, k \ge 2, S(F_3)=4.$$

Полагая $l(k) = S(F_{2^k-1}),$ перейдем к линейному рекуррентному соотношению $l(k)=3l(k-1)+1, l(2)=4$, решением которого будет
$l(k)=(3^k-1)/2.$ Обозначив $n=2^k-1$ и выразив $3^k=(2^k)^{\log_23}=(n+1)^{\log_23},$ получим, что
$$S(F_n)=l(k)=\frac{(n+1)^{\log_23}-1}{2}=O(n^{log_23})$$

В общем случае равенство $S(F_n)=O(n^{\log_23})$ сохраняется, так как выбрав $k$ таким образом, что $2^k-1 < n \le 2^{k+1}-1$, можно заметить, что матрица
$F_n$ является главной подматрицей матрицы $F_m$, $m=2^k-1$, откуда имеем
$$S(F_n)\le S(F_m)=O(m^{log_23})=O(n^{\log_23}).$$
Аналогично можно оценить плотность матрицы $F_n'=F_n\cdot B_n$, и непосредственно проверяется, что в матрице $B_n$ все элементы нулевые, кроме элементов
$b_{i,i+1}=1$ над диагональю и некоторых элементов нижней строки $b_{n,j}$ и справедливы следующие равенства для элементов матрицы $F_n':$
$$f_{i,1}'=f_{i,n}b_{n,1}=\delta_{i,n}b_{n,1}, f_{i,j}'=f_{i,j-1}+f_{i,n}b_{n,j}=f_{i,j-1}+\delta_{i,n}b_{n,j},$$
так как в силу того, что матрица $F_n$ нижнетреугольная, для ее элементов имеем $f_{i,n}=\delta_{i,n}$, где $\delta_{i,n}$ - дельта-символ Кронекера. 
Складывая эти равенства, получим, что
$$S(F_n')=\sum_{i=1,j=1}^{n,n-1}f_{i,j}+\sum_{j=1}^{n}b_{n,j}=S(F_n)-1+\sum_{j=1}^{n}b_{n,j}\le S(F_n)-1+n=O(n^{\log_23}).$$
\end{proof} 

Обозначим через $L(F_n)$ сложность линейного преобразования, определяемого матрицей $F_n$ (в данном случае - это наименьшее число операций сложения по 
модулю два, необходимых для вычисления этого преобразования).
\begin{Theorem}\label{lfn}
$L(F_n)\le \frac{n}{2}\log_2n+2n=O(n\log_2n)$
\end{Theorem}     
\begin{proof}
Нам будет удобно оценивать сложность преобразования, задаваемого транспонированной матрицей $F_n^T$, которая равна $L(F_n)$ согласно известной лемме о
взаимосвязи сложности транспонированных матриц (см. например \cite{gashkov1}). Впрочем, для дальнейшего нам нужно будет оценить сложность перехода
от координат в нормальном базисе
$$\sum_{i=1}^{n}x_i\alpha_i$$
к координатам в почти стандартном базисе
$$\sum_{i=1}^{n}y_ix^i,$$
которая определяется как раз матрицей $F^T_n$. Пусть $2^k \le n \le 2^{k+1},$ тогда с использованием формул из леммы имеем
\begin{align*}
\sum_{i=1}^{n}y_ix^i=\sum_{i=1}^{n}x_ia_i=\sum_{i=1}^{2^k}x_ia_i+\sum_{i=2^k+1}^{n}x_ia_i=\\
=\sum_{i=1}^{2^k}x_ia_i+\sum_{i=1}^{n-2^k}x_{i+2^k}a_{i+2^k}=\sum_{i=1}^{2^k}x_ia_i+\sum_{i=1}^{n-2^k}x_{i+2^k}(a^{2^k}a_i+a_{2^k-i})=\\
=x_{2^k}a_{2^k}+\sum_{i=1}^{2^{k+1}-n-1}x_ia_i+\sum_{i=2^{k+1}-n}^{2^k-1}(x_i+x_{2^{k+1}-i})a_i+a^{2^k}\sum_{i=1}^{n-2^k}x_{i+2^k}a_i,
\end{align*}
где $a_0=0$. Далее, определяя векторы-столбцы 
$$X=\{x_1,...,x_n\}^T,$$ 
$$X_1=\{x_1,...,x_{2^{k+1}-n-1},x_{2^{k+1}-n}+x_n,...,x_{2^k-1}+x_{2^k+1},x_{2^k}\}^T,$$
где, естественно, в случае $n=2^{k+1}-1$
$$X_1=\{x_1+x_n,...,x_{2^k-1}+x_{2^k+1},x_{2^k}\}^T,$$
а в случае $n=2^{k+1}$
$$X_1=\{x_1+x_{n-1},...,x_{2^k-1}+x_{2^k+1},x_{2^k}\}^T,$$
и во всех случаях 
$$X_2=\{x_{1+2^k,...,x_n}\}^T,$$
и вектора-строки
$$Y_1=\{y_1,...,y_{2^k}\}, Y_2=\{y_{1+2^k},...,y_n\},$$
получим
\begin{align*}
\sum_{i=1}^{n}y_ix^i=\sum_{i=1}^{n}x_ia_i=\sum_{i=1}^{2^k}X_{1,i}a_{i}+x^{2^k}\sum_{i=1}^{n-2^k}X_{2,i}a_i=\\
=\sum_{i=1}^{2^k}Y_{1,i}a^i+\sum_{i=1}^{n-2^k}Y_{2,i+2^k}a_{i+2^k},
\end{align*}
значит
\begin{equation}\label{otimes}
F^T_n\otimes X=(y_i'...y_n')=(Y_1,Y_2)=(F^T_{2^k}\otimes X_1, F^T_{n-2^k}\otimes X_2),
\end{equation}
где $\otimes$ - операция умножения матрицы на вектор в поле $GF(2)$. Разумеется, последнее равенство можно было получить, основываясь только на
структуре матрицы $F_n$. Осталось индуктивно оценить сложность преобразования координат, определяемого матрицей $F^T_n$. Согласно последнему равенству
$$L(2^{m+1})\le 2^m-1+2L(2^m), m\le k-1, L(2)=2$$
По индукции непосредственно проверяется, что
$$L(2^m)=2^{m-1}m+1$$
Для произвольного $n$ в пределах $2^k < n < 2^{k+1}$ получим
\begin{align*}
L(n)\le 2^{k_s-1}k_s+...+2^{k_1-1}k_1+s-1+(n-2^{k_s})+...\\
...+(n-2^{k_s-...-2^{k_2}})\le \frac{n}{2}\log_2n+c\frac{n}{2},
\end{align*}
где
$$c=1\frac{2}{2}+\frac{3}{4}+\frac{4}{8}+\frac{5}{16}+...<4$$	                                            
\end{proof}

\begin{Theorem}
Сложность $B(n)$ перехода в поле $GF(2^n)$ от оптимального нормального базиса второго или третьего типа к соответсвтующему стандартному
и наоборот удовлетворяет неравенству
$$B(n)\le \frac{n}{2}\log_2n + 3n$$
\end{Theorem}
\begin{proof}
Обозначим $x=\zeta+\zeta^{-1}$ генератор стандартного базиса
$$A = \{1,x^1,...,x^{n-1}\}$$
и базиса второго или третьего типа 
$$B = \{x^{2^0}, x^{2^1},...,x^{2^{n-1}}\}.$$

\textbf{Переход от нормального базиса к стандартному}.
Переход будет осуществляться через цепочку из четырех базисов
$$B\to B'\to A' \to A$$
и преобразования координат элемента $f$ поля $GF(2^n)$ в этих базисах
$$f=\sum_{i=1}^{n}x_ix^{2^{i-1}}=\sum_{i=1}^{n}x_i'a_i=\sum_{i=1}^{n}y_i'x^i=\sum_{i=1}^{n}y_ix^{i-1},$$
где $a_i$ обозначает $\zeta^i+\zeta^{-i}, B'=\{a_1,...,a_n\}, A'=\{x^1,...,x^n\}.$

\textbf{Переход от базиса $B$ к базису $B'$ и преобразование  координат $\tilde{x}$ к координатам $\tilde{x}'$}. 
Этот переход осуществляется перестановкой базисных элементов, и действительно, существует такая перестановка $\pi(i)$ чисел
$\{1,...,n\}$, что для любого $i=1,...,2n$ выполняется равенство
\begin{equation}\label{plusminus}
2^i\mod p=\pm \pi(i) \in \{1,...,n\}.
\end{equation}
В самом деле, для базиса второго типа последовательность степеней
$$1,2,2^2,...,2^{2n-1},$$
вычисленных по модулю $p$, совпадает с некоторой перестановкой 
$$\pi(1),...,\pi(2n)$$
множества чисел $\{1,...,2n\}$ в силу того, что 2 - примитивный корень по модулю $p$. А в силу эквивалентности
$$2^{k+n}\equiv -2^k\mod p,$$
(по теореме Ферма $2^{2n}\equiv 1\mod p$, значит, $2^n\equiv -1\mod p$) окончательно получим формулу (\ref{plusminus})

В случае же базиса третьего типа число 2 является квадратичным вычетом по модулю $p$, поэтому все степени $2^k\mod p, k=1,...,n-1$
образуют перестановку множества всех квадратичных вычетов по модулю $p$, так как их ровно $n$ штук. Добавив к этому тот факт, что $p$ равно 3
по модулю 4, и поэтому -1 является квадратичным невычетом по модулю $p$, так как в противном случае существовало бы такое число $r$, что 
$-1 \equiv r^2\mod p$, а это приводило к противоречию с теоремой Ферма:
$$r^{p-1}=(r^2)^{\frac{p-1}{2}}\equiv-1\mod p,$$
и тот факт, что произведение вычета на невычет является невычетом, получаем, что последовательность $-2^k\mod p, k=0,...,n-1$ образует
перестановку множества всех квадратичных невычетов по модулю $p$, в итоге получаем, что и в этом случае верна формула (\ref{plusminus})

Таким образом, мы получили, что базис $\{a_1,...,a_n\}$ есть просто перестановка базиса $\{x,...,x^{2^{n-1}}\}$. Отрицательные индексы можно заменить
на соответствующие положительные благодаря равенству $a_i = \zeta^i+\zeta^{-1}=a_{-i}$ по формуле $x^{2^i}=a_{|\pi(i)|}$ (или для координат $x_i=x_{|\pi(i)|'}$.
Поэтому далее везде будем считать индексы положительными, и знак модуля числа будем опускать.

Очевидно, что $B'$-тоже базис, так как он есть просто перестановка базиса $B$. Можно считать, что сложность перехода $L_{BB'}(n)=O(n)$, а если
рассматривать не программную, а схемную реализацию, то даже $L_{BB'}(n)=0$.

\textbf{Переход от базиса $B'$ к базису $A'$ и преобразование координат $\tilde{x}'$ к координатам $\tilde{y}'$}
Согласно теореме (\ref{lfn}) его сложность оценивается как
$$L(n)\le \frac{n}{2}\log_2n+2n$$

\textbf{Переход от базиса $A'$ к базису $A$ и преобразование координат $\tilde{y}'$ к координатам $\tilde{y}$}.
По рекуррентной формуле (\ref{otimes}) можно в явном виде построить минимальный многочлен $m_x$ (он строится лишь однажды, до применения алгоритма
перехода, поэтому сложность его построения в сложности алгоритма не учитывается), т.е.
\begin{equation}\label{minimal}
m_x = f_n(x)=b_0x^0+...+b_nx^n=0
\end{equation}
где $x$ - генератор этих базисов, и не все коэффициенты $b_i$ равны нулю. Сделаем явный переход от координат $\tilde{y}'$ в почти стандартном базисе 
$A'$ к координатам $\tilde{y}$ в стандартном $A$. Учитывая выражение (\ref{minimal}),
$$\sum_{i=1}^{n}y_i'x^i=\sum_{i=1}^{n-1}y_i'x^i+y_n'\sum_{i=0}^{n-1}b_ix^i,$$
после перегруппировки коэффициентов имеем
$$\sum_{i=1}^{n}y_i'x^i=\sum_{i=1}^{n-1}x^i(y_i'+b_iy_n')+y_n'x^0=\sum_{i=1}^{n-1}y_ix^i+y_0x^0,$$
откуда видно, что сложность перехода от почти стандартного базиса $A'$ к стандартному $A$ оценивается как $L_{A'A}(n)\le n-1$.

Итак, мы оценили сложность каждого преобразования, теперь осталось их сложить:
$$L_{BA}(n)=L_{BB'}(n)+L_{B'A'}(n)+L_{A'A}(n)\le \frac{n}{2}\log_2n+3n.$$
\end{proof}

\textbf{Переход от стандартного базиса к нормальному.}
Теперь покажем, что теорема верна и при обратном переходе, т.е. от стандартного базиса $A$ к базису второго или третьего типа $B$. Опять определим цепочку
переходов, но уже в обратном порядке:
$$A\to A'\to B' \to B.$$

\textbf{Переход от базиса $A$ к базису $A'$ и от координат $\tilde{y}$ к $\tilde{y}'$.}
Опять же в силу рекуррентной формулы (\ref{otimes}) у нас есть минимальный многочлен (\ref{minimal}), из явного вида которого мы можем выразить $x^0$,
а именно:
\begin{equation}\label{x0}
x^0=\sum_{i=1}^{n}b_ix^i
\end{equation}
Сделаем явный переход от координат $\tilde{y}$ в стандартном базисе $A$ к координатам $\tilde{y}'$ в почти стандартном $A'$. Принимая во внимание выражение
(\ref{x0}), имеем
$$\sum_{i=0}^{n-1}y_ix^i=\sum_{i=1}^{n-1}y_ix^i+y_0\sum_{i=1}^{n}b_ix^i,$$
после перегруппировки коэффициентов получим                       
$$\sum_{i=0}^{n-1}y_ix^i=\sum_{i=1}^{n-1}x^i(y_i+b_iy_0)+y_0x^n=\sum_{i=1}^{n-1}y_i'x^i+y_n'x^n,$$
откуда видно, что сложность перехода от стандартного базиса $A$	к почти стандартному базису $A'$ оценивается как $L_{AA'}(n)\le n-1$.

\textbf{Переход от базиса $A'$ к базису $B'$ и преобразование координат $\tilde{y}'$ к координатам $\tilde{x}'$.}
Вычислим преобразование
\begin{equation}
(x_1',...,x_n')=(F_n^{-1})^T\otimes
\left(
\begin{matrix}
y_1''\\
... \\
y_n''\\
\end{matrix}
\right)
\end{equation}
умножения вектора $Y^T$ на матрицу $(F_{2^{k+1}}^{-1})^T$ (обратную к матрице из теоремы (\ref{lfn}) с помощью (\ref{otimes}). В этой формуле 
рекуррентно выполнялись преобразования с векторами $X_1$ и $X_2$,  переводящие их в векторы $Y_1=(y_1',...,y_{2^k}'')$ и $Y_2=(y_{2^k+1}',...,y_n')$,
составляющие вектор $Y=(y_1',...,y_n').$ Естественно, что обратное преобразование $(F_{n-2^k}^{-1})^T\otimes Y_2^T$ приведет вектор $Y_2$ в вектор $X_2$,
а чтобы получить вектор $X_1$, надо сделать преобразование $(F_{2^k}^{-1})^T\otimes Y_1^T$. Так как
$$X_1=\{x_1,...,x_{2^{k+1}-n-1},x_{2^{k+1}-n}+x_n,x_{2^k-1}+x_{2^k+1},x_{2^k}\}^T,$$
$$X_2=\{x_{1+2^k},...,x_n\}^T,$$
то для восстановления вектора $X=\{x_1,...,x_n\}$ по этим векторам достаточно к соответствующим $n-2^k$ компонентам вектора $X_1$ прибавить 
(по $mod 2$) компоненты вектора $X_2$.

Индуктивно продолжая описанное преобразование, мы перейдем к координатам $\tilde{x}'$ в почти нормальном базисе $B'$ со сложностью перехода
$$L^{-1}(n)\le n-2^k +L^{-1}(2^k) +L^{-1}(n-2^k),$$
и, как раньше, придем к оценке
$$L_{B'A'}(n)\le \frac{n}{2}\log_2n+2n.$$

\textbf{Переход от базиса $B'$ к базису $B$ и координат $\tilde{x}'$ к $\tilde{x}$.}
Переход получается посредством обратной перестановки к $\pi(i)$, а его сложность оценивается, как и раньше, т.е. $L_{B'B}(n)=0$.

В результате имеем
$$L_{AB}(n)=L_{AA'}(n)+L_{A'B'}(n)+L_{B'B}(n)\le \frac{n}{2}\log_2n +3n.$$

Заметим, что при вычислении обратного преобразования $(F_n^{-1})^T$ при $n=2^{k+1}-1$ мы фактически получили матричное тождество
\begin{equation}
(F_n^T)^{-1}=
\left(
\begin{matrix}
(F_m^T)^{-1} & o_m & G_m\\
0...0        & 1   & 0...0\\
O_m          & o_m & (F_m^T)^{-1}\\
\end{matrix}
\right)
\end{equation}
где $m=(n-1)/2$, а матрица $G_m=I_m(F_m^T)^{-1}$ есть симметричное отражение матрицы $(F_m^T)^{-1}$ относительно средней строки. Это тождество, 
так же как и аналогичное тождество
\begin{equation}
F_n^{-1}=
\left(
\begin{matrix}
F_m^{-1}     & o_m & O_m\\
0...0        & 1   & 0...0\\
G_m          & o_m & F_m^{-1}\\
\end{matrix}
\right)
\end{equation}
(здесь $m=(n-1)/2$), а матрица $G_m=F_m^{-1}I_m$ есть симметричное отражение матрицы $F_m^{-1}$ относительно среднего столбца) можно проверить и 
непосредственно. С помощью этих тождеств, так же как и в теореме (\ref{logn3}), можно доказать, что плотность обратной матрицы $S(F_n^{-1})=O(n^{\log_23})$
и такую же плотность имеет матрица перехода от нормального базиса второго или третьего типа к стандартному базису поля $GF(2^n)$.

\subsection{Алгоритм перехода от оптимального нормального базиса 2 или 3 типа к стандартному.}
\begin{algorithm}[H]
\caption{OptimalToStandard}
\textbf{Вход:}
степень $n$ расширения поля $GF(2)$, вектор $(b_1,...,b_n)\in GF(2^n)$ координат элемента, представленного в ОНБ второго или третьего типа,
$P$ - вектор коэффициентов минимального многочлена.

\textbf{Выход:}
вектор $a=(a_0,...,a_n-1)\in GF(2^n)$ координат того же элемента, представленного в стандартном базисе с тем же генератором.
\begin{enumerate}
\item
Переход от оптимального нормального базиса $B$ второго или третьего типа к почти нормальному $B'$:\\
для $j=0,...,n-1  c_j=b_{\pi (j)},$ где 
\begin{equation*}
\pi(j)=
\left\{
\begin{matrix}
  (2^j \mod p), & \mbox{если } (2^j \mod p)\le n \\
  p-(2^j \mod p),& \mbox{если } (2^j \mod p)> n \\
\end{matrix}
\right.
\end{equation*}
\item
Добавить к полученному вектору справа $2^{r-1}-n$ нулей, где $r$ определяется из неравенства $2^{r-1}<n\le 2^r$.
Таким образом получить вектор $X$ длины $2^r$.
\item
Переход от почти нормального базиса $B'$ к почти стандартному $S'$.\\ 
Для $i=1,...,r-1:$\\
для $j=0,...,2^{i-1}-1:$
\begin{align*}
X[j\cdot 2^{r-i+1},2^{r-1}+j\cdot 2^{r-i+1}-1= \\
=F(X[j*2^{r-i+1},2^{r-1}+j\cdot 2^{r-i+1}-1],X[2^{r-1}+j\cdot 2^{r-i+1}, (j+1)\cdot 2^{r-i+1}-1]),
\end{align*}
где $F(X_1, X_2)=(X_1\oplus \widetilde{\widetilde{X_2}}, X_2),$
где $\widetilde{\widetilde{Y}} = \overline{Y\gg 1}$ - сдвиг на один разряд вправо с потерей старшего разряда
и обращение порядка следования бит полученного вектора.
\item
Переход от почти стандартного базиса $S'$ к стандартному $S$:\\
если $deg~a~=~deg~P$, то $A = X\oplus P$.
\item
Вернуть $a$.
\end{enumerate}
\end{algorithm}

\subsection{Алгоритм перехода от стандартного базиса к оптимальному нормальному базису второго типа}
\begin{algorithm}[H]
\caption{StandardToONB2}
\textbf{Вход: }
Степень $n$ расширения поля GF(2), вектор $a=(a_0,...,a_{n-1})\in GF(2^n)$ координат элемента, представленного в стандартном базисе,
$P$ - вектор коэффициентов минимального многочлена.
\textbf{Выход: }
вектор $(b_1,...,b_n)\in GF(2^n)$ координат того же элемента, представленного в ОНБ 2 типа с тем же генератором, или сообщение 
"ОНБ второго типа не существует".
\begin{enumerate}
\item
Вычислить $p=2n+1$, проверить условия ОНБ второго типа:\\
a) $p$ - простое число;\\
b) $2$ является примитивным корнем из $1$ по модулю $p$:
для каждого простого делителя $\delta$ числа $p-1$ выполняется $2^{\frac{p-1}{\delta}}\ne 1$.
Если хотя бы одно из этих условий не выполняется, то вернуть сообщение ОНБ 2 типа не существует.
\item
Переход от стандартного базиса $S$ к почти стандартному $S'$:
если $a_0=1, C=a\oplus P,$\\
иначе $C=a$
\item
Добавить к полученному вектору справа $2^r-n$ нулей, где $r$ определяется из неравенства $2^{r-1}<n\le 2^r$.
Таким образом получить вектор $X$ длины $2^r$.
\item
Переход от почти стандартного базиса $S'$ к почти нормальному $B'$.\\
Для $i=r-1,...,1$:\\
для $j=0,...,2^{i-1}-1:$
\begin{align*}
X[j\cdot 2^{r-i+1}, 2^{r-i}+j\cdot 2^{r-i+1}-1]=\\
=F(X[j\cdot 2^{r-i+1}, 2^{r-i}+j\cdot 2^{r-i+1}-1],X[2^{r-i}+j\cdot 2^{r-i+1},(j+1)2^{r-i+1}-1]).
\end{align*}
где $F(X_1, X_2)=(X_1\oplus \widetilde{\widetilde{X_2}},X_2),$ где $\widetilde{\widetilde{Y}}=\overline{Y\gg 1}$ - сдвиг на один разряд вправо с потерей
старшего разряда и обращение порядка следования бит полученного вектора.
\item
Переход от почти нормального базиса $B'$ к нормальному $B$:\\
Для $j=1,...,n b_j=b_{\pi^{-1}(j)}',$ где $\pi^{-1}(j)$ - обратная к $\pi(j)$ (вычисленной в предыдущем алгоритме перестановка).
\item
Вернуть $(b_1,...,b_n)$.
\end{enumerate}
\end{algorithm} 

\subsection{Алгоритм перехода от стандартного базиса к оптимальному нормальному базису третьего типа}
От алгоритма перехода к ОНБ 2 типа этот алгоритм отличается лишь условием существования базиса.
\begin{algorithm}[H]
\caption{StandardToONB3}
\textbf{Вход: }
Степень $n$ расширения поля GF(2), вектор $a=(a_0,...,a_{n-1})\in GF(2^n)$ координат элемента, представленного в стандартном базисе,
$P$ - вектор коэффициентов минимального многочлена.
\textbf{Выход: }
вектор $(b_1,...,b_n)\in GF(2^n)$ координат того же элемента, представленного в ОНБ 3 типа с тем же генератором, или сообщение 
"ОНБ третьего типа не существует".
\begin{enumerate}
\item
Вычислить $p=2n+1$, проверить условия ОНБ третьего типа:\\
a) $p$ - простое число;\\
b) $2^n=1\mod p$;\\
c) Для каждого простого делителя $\delta$ числа $p-1$ выполняется $2^{\frac{n}{\delta}}\mod p \ne 1$.
Если хотя бы одно из этих условий не выполняется, то вернуть сообщение ОНБ 3 типа не существует.
\item
Переход от стандартного базиса $S$ к почти стандартному $S'$:
если $a_0=1, C=a\oplus P,$\\
иначе $C=a$
\item
Добавить к полученному вектору справа $2^r-n$ нулей, где $r$ определяется из неравенства $2^{r-1}<n\le 2^r$.
Таким образом получить вектор $X$ длины $2^r$.
\item
Переход от почти стандартного базиса $S'$ к почти нормальному $B'$.\\
Для $i=r-1,...,1$:\\
для $j=0,...,2^{i-1}-1:$
\begin{align*}
X[j\cdot 2^{r-i+1}, 2^{r-i}+j\cdot 2^{r-i+1}-1]=\\
=F(X[j\cdot 2^{r-i+1}, 2^{r-i}+j\cdot 2^{r-i+1}-1],X[2^{r-i}+j\cdot 2^{r-i+1},(j+1)2^{r-i+1}-1]).
\end{align*}
где $F(X_1, X_2)=(X_1\oplus \widetilde{\widetilde{X_2}},X_2),$ где $\widetilde{\widetilde{Y}}=\overline{Y\gg 1}$ - сдвиг на один разряд вправо с потерей
старшего разряда и обращение порядка следования бит полученного вектора.
\item
Переход от почти нормального базиса $B'$ к нормальному $B$:\\
Для $j=1,...,n b_j=b_{\pi^{-1}(j)}',$ где $\pi^{-1}(j)$ - обратная к $\pi(j)$ (вычисленной в предыдущем алгоритме перестановка).
\item
Вернуть $(b_1,...,b_n)$.
\end{enumerate}
\end{algorithm}