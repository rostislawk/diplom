\section{Арифметика в нормальных базисах}
\subsection{Алгоритм генерации оптимальных нормальных базисов второго типа}
Базис второго типа возникает, когда $2n+1=p$ - простое число, $q$ - является примитивным корнем из 1 по модулю $p$.
Элемент $\zeta$ тогда будет примитивным корнем степени $p$ из 1 в поле $GF(q^{2n})$, в качестве порождающего элемента
оптимального нормального базиса нужно взять $\alpha=\zeta+\zeta^{-1}$.

\begin{algorithm}[H]
\caption{ONB2GEN}
\textbf{Вход:}
степень $n$ расширения поля $GF(2)$. 
\\
\textbf{Выход:}
вектор $b = (b_1,...,b_n)$ коэффициентов неприводимого многочлена $b_0 + b_1X + ... + b_{n-1}X^{n-1} + b_nX^n$ с корнем $x$ - генератором ОНБ 2-го типа,
таблица умножения $A$ в ОНБ, порождаемом генератором $x$ (в виде матрицы или списка коордат единичных элементов) или
сообщение "ОНБ второго типа не существует". 
\\
\textbf{Шаги:}
\begin{enumerate}
\item
Вычислить $p=2n+1$, проверить условия ОНБ второго типа:\\
a) $p$ - простое число;\\
б) 2 - является примитивным корнем 1 по модулю $p$:\\
для каждого простого делителя $\delta$ числа $p-1$ выполняется $2^{(p-1)/\delta }\ne1$\\
Если хотя бы одно из этих условий не выполняется, то вернуть сообщение "ОНБ второго типа не существует".

\item
Вычислить вектор $b$:\\
для $j=0,...,n$: вычислить двоичные коды  $N$ и $M$ чисел $\lfloor \frac{(n+j)}{2} \rfloor$ и $j$,\\
принять $b_j=1,$ если $\neg(\neg M \vee N) = 0$ и $0$ в остальных случаях.

\item
Образовать нулевую $n \times n$ матрицу $A$ (или образовать пустой список $A$).\\
Заполнить ненулевые элементы:\\
для $k=0,...,2n$ вычислить $\pi(k)=2^k\mod p$;\\                                              
для $k=1,...,2n$ вычислить $\pi^{-1}(k)=dlog_2k\mod p$;\\
для $k=0,...,n-1$\\
вычислить $\sigma(k)=(\pi^{-1}(1+2^k)\mod p)\mod n=(dlog_2(1+2^k)\mod p)\mod n;$\\
для $k=1,...,n-1$\\
вычислить $\mu(k)=(\pi^{-1}(-1+2^k)\mod p)\mod n=(dlog_2(-1+2^k)\mod p)\mod n$;\\
для $k=0,...,n-1$\\
включить пару $(k, \sigma(k))$ в список $A$;\\
для $k=1,...,n-1$\\
включить пару $(k,\mu(k))$ в список $A$;

\item
Вернуть $b$ и $A$. 
\end{enumerate}
\end{algorithm}

\subsubsection{Доказательство оптимальности.}
Так как $q^n \equiv -1 \mod p$, то 
$$\alpha^{q^n}=\zeta^{q^n}+\zeta^{-q^n}=\zeta+\zeta^{-1}=\alpha,$$
значит, $\alpha^{q^n}=\alpha$, поэтому $\alpha$ принадлежит подполю $GF(q^n)$ поля $GF(q^{2n})$. Система 
$$\{\alpha,\alpha^q,\alpha^{q^2},...,\alpha^{q^{n-1}}\}$$
линейно независима, так как 
$$\alpha^{q^k}=\zeta^{q^k}+\zeta^{-q^k}=\zeta^{q^k}+\zeta^{q^{k+n}}$$
в силу эквивалентности $q^{k+n}\equiv-q^k\mod p$, а система
$$\{\zeta,\zeta^q,\zeta^{q^2},...,\zeta^{q^{2n-1}}\}$$
линейно независима. Можно проверить, что при $n>k>0$
$$\alpha\alpha^{q^k}=(\zeta+\zeta^{-1})(\zeta^{q^k}+\zeta^{-q^k})=\zeta^{1+q^k}+\zeta^{-1-q^k}+\zeta^{1-q^k}+\zeta^{-1+q^k}=\alpha^{q^s}+\alpha^{q^t},$$
значит, соответствующая этому базису матрица $T$ при $q=2$ содержит $2n-1$ единицу, потому что при $k=0$ разложение $\alpha\alpha^{q^0}$ по базису
состоит из одного слагаемого, ведь $\alpha^2=(\zeta+\zeta^{-1})^2=\zeta^2+\zeta^{-2}=\alpha^{q^s}$.

Для выполнения указанной проверки заметим, что согласно определению последовательность $q^k\mod p, k=0,...,2n-1$ является перестановкой
$\pi(1),...,\pi(2n)$ множества чисел $\{1,...,2n\}$ в силу того, что $q$-примитивный корень по модулю $p=2n+1$, причем в силу соотношения
$$q^{k+n}\equiv-q^k\mod p, k=0,...,n-1,$$
справедливо равенство
$$\pi(k)+\pi(k+n)=p, k=0,...,n-1,$$
а так как все неупорядоченные пары
$$(1+q^k\mod p, -1-p^k\mod p)$$
при любом $k, k=0,...n-1$, отличны от пары $(0,0)$, то их последовательность состоит из пар
$$\pi(k), \pi(k+n)), k=0,...,n-1,$$
т.е. из неупорядоченных пар вида $(u, p-u), 0 < u \ge n,$ значит существует такое отображение $(\sigma(1),...,\sigma(n))$ множества чисел $1,...,n$ в себя,
что 
$$\zeta^{1+q^k}+\zeta^{-1-q^k}=\zeta^{q^{\sigma(k)}}+\zeta^{-q^{\sigma(k)}}=\alpha^{q^{\sigma(k)}}.$$

Аналогично определяется отображение $\mu(1),...,\mu(n)$ множества $1,...,n$ в себя, такое, что 
$$\zeta^{-1-q^k}+\zeta^{-1+q^k}=\zeta^{q^{\mu(k)}}+\zeta^{-q^{\mu(k)}}=\alpha^{q^{\mu(k)}}$$
при любом $n \ge k > 0.$

Так как 
$$1-q^k \ne 1 + q^k, 1-q^k \ne -1-q^k$$
по модулю $p$, то при любом $n > k > 0$ справедливо неравенство
$$\mu(k)\ne\sigma(k).$$

Вспоминая определение матрицы $T$ посредством равенств
$$\alpha\alpha^{q^i}=\sum_{j=0}^{n-1}t_{i,j}\alpha^{q^j}$$
и сравнивая их с полученными равенствами
$$\alpha\alpha^{q^i} = \alpha^{q^{\sigma(i)}}+\alpha^{q^{\mu(i)}}, i>0,$$
\begin{align*}
\alpha\alpha^{q^0}=\zeta^{1+q^0}+\zeta^{-1-q^0}+\zeta^{1-q^0}+\zeta^{-1+q^0}=\zeta^{1+q^0}+\zeta^{-1-q^0}+\zeta^0+\zeta^0=\\
=\zeta^{1+q^0}+\zeta^{-1-q^0}=\alpha^{q^{\sigma(1)}},
\end{align*}
имеем
$$t_{i,j}=\delta_{\sigma(i+1),j}+\delta_{\mu(i),j}, i\ne0, t_0,j=\delta_{\sigma(1),j},$$
где $\sigma_{k,s}$ - дельта-символ Кронекера, равный 1 при $k=s$, и нулю в противном случае.

\subsubsection{Свойства матрицы $T$.}
Для оптимизации вычислений при построении оптимального нормального базиса второго типа в поле $GF(2^n)$ докажем два утверждения: \cite{bolotov1}
\begin{Statement}
Для матрицы $T$ оптимального нормального базиса второго типа в поле $GF(2^n)$ равенство $t_{i,j}=1$ верно тогда и только тогда, когда
выполняется одно из четырех соотношений
$$2^i\pm2^j\equiv\pm1\mod 2n+1$$
\end{Statement}  

Действительно, согласно определению матрицы $T$ ее элемент $t_{i,j}=1$, тогда и только тогда, когда в разложении $\alpha\alpha^{2^i}$. Но 
в силу равенства 
$$\alpha\alpha^{2^i}=(\xi+\xi^{-1})(\xi^{2^i}+\xi^{-2^i})=(\xi^{2^i-1}+\xi^{-2^i+1})+(\xi^{2^i+1}+\xi^{-2^i-1})$$
и того факта, что $\xi^p=1, p=2n+1$, так как $\xi$ - первообразный корень $p$-й степени из единицы, это возможно, тогда и только тогда, когда 
$2^i\pm1\equiv\pm2^j\mod 2n+1$. Последняя эквивалентность равносильна $\pm2^i\pm2^j\equiv\pm1\mod 2n+1$ и эквивалентности $2^i\pm2^j\equiv\pm1\mod 2n+1$.

\begin{Statement}
В случае оптимального нормального базиса второго типа в поле $GF(2^n)$ матрицы $T$ и $A$ совпадают.
\end{Statement}  

Действительно, так как $a_{i,j}=t_{i-j,-j}$, то согласно предыдущему утверждению $a_{i,j}=1$, тогда и только тогда, когда $\pm2^{i-j}\pm2^{-j}\equiv\pm1\mod p$
, где $i-j$ и $-j$ вычисляются по модулю $n$. Поэтому вместо $-j$ можно взять $n-j$, а вместо $i-j$ при $i-j<0$ можно взять $n+i-j$. Умножая обе
части эквивалентности на $2^j$ по модулю $p$, получаем равносильное соотношение $\pm2^{i+n}\pm2^n\equiv\pm2^j\mod p$, которое в силу эквивалентности
$2^n\equiv\pm1\mod p$ равносильно соотношению $\pm2^{i+n}\pm2^n\equiv\pm2^j\mod p$. Эквивалентность $2^n\equiv\pm1\mod p$ вытекает из малой теоремы Ферма
$2^{2n}\equiv1\mod p$.
                                                                                                                                               

\section{Алгоритм генерации оптимальных нормальных базисов третьего типа}

Базис третьего типа возникает, когда $n$ нечетно, $2n+1=p$ - простое число, а условие на $q$ заменяется на то, что $q^n\equiv 1\mod p$, и при любом
$0 < k < n, q^k \not\equiv 1\mod p$ (другими словами, число $q$ имеет по модулю $p$ порядок $n$, а не $2n$, как во втором случае, и тогда автоматически 
существует такое $r$, что $q = r^2\mod p$, т.е. $q$ - квадратичный вычет по модулю $p$, и поэтому все его степени $q^k\mod p, k = 0,...,n-1$ образуют 
перестановку множества всех квадратичных вычетов по модулю $p$, так как их ровно $n$ штук).

Поскольку $p$ равно 3 по модулю 4, то -1 является квадратичным невычетом по модулю $p$, потому что в противном случае существовало бы такое число $r$,
что $-1\equiv r^2 \mod p$, и тогда получилось бы противоречие с малой теоремой Ферма:
$$r^{p-1}=(r^2)^{\frac{(p-1)}{2}}\equiv -1\mod p$$.

Поэтому из того, что произведение вычета на невычет является невычетом, следует, что последовательность $-q^k \mod p, k = 0,...,n-1$ образует перестановку
множества всех квадратичных невычетов по модулю $p$. 

Как и в случае базиса второго типа, в качестве элемента $\zeta$ берется примитивный корень степени $p$ из 1 в поле $GF(q^{2n})$, а в качестве порождающего
элемента оптимального нормального базиса - элемент $\alpha = \zeta + \zeta^{-1}$.

\begin{algorithm}[H]
\caption{ONB3GEN}
\textbf{Вход:}
степень $n$ расширения поля $GF(2)$. 
\\
\textbf{Выход:}
вектор $b = (b_1,...,b_n)$ коэффициентов многочлена $b_0 + b_1X + ... + b_{n-1}X^{n-1} + b_nX^n$ с корнем $x$ - генератором ОНБ 3-го типа,
таблица умножения $A$ в ОНБ, порождаемом генератором $x$ (в виде матрицы или списка коордат единичных элементов) или
сообщение "ОНБ третьего типа не существует". 
\\
\textbf{Шаги:}
\begin{enumerate}
\item
Вычислить $p=2n+1$, проверить условия ОНБ третьего типа:\\
a) $p$ - простое число;\\
б) $2^n\equiv1\mod p;$\\
в) для каждого простого делителя $\delta$ числа $n$ выполняется $2^{\frac{n}{\delta}}\mod p \ne 1.$\\
Если хотя бы одно из этих условий не выполняется, то вернуть сообщение "ОНБ третьего типа не существует".

\item
Вычислить вектор $b$:\\
для $j=0,...,n$: вычислить двоичные коды  $N$ и $M$ чисел $\lfloor \frac{(n+j)}{2} \rfloor$ и $j$,\\
принять $b_j=1,$ если $\neg(\neg M \vee N) = 0$ и $0$ в остальных случаях.

\item
Образовать нулевую $n \times n$ матрицу $A$ (или образовать пустой список $A$).\\
Заполнить ненулевые элементы:\\
для $k=0,...,2n$ вычислить $\pi(k)=2^k\mod p$;\\                                              
для $k=1,...,2n$ вычислить $\pi^{-1}(k)=dlog_2k\mod p$;\\
для $k=0,...,n-1$\\
вычислить $\sigma(k)=(\pi^{-1}(\pm(1+2^k))\mod p)\mod n=(dlog_2(\pm(1+2^k))\mod p)\mod n;$\\
для $k=1,...,n-1$\\
вычислить $\mu(k)=(\pi^{-1}(\pm(-1+2^k))\mod p)\mod n=(dlog_2(\pm(-1+2^k))\mod p)\mod n$;\\
для $k=0,...,n-1$\\
включить пару $(k, \sigma(k))$ в список $A$;\\
для $k=1,...,n-1$\\
включить пару $(k,\mu(k))$ в список $A$;

\item
Вернуть $b$ и $A$. 
\end{enumerate}
\end{algorithm}

\subsubsection{Доказательство оптимальности.}
Доказательство линейной независимости системы $\{\alpha, \alpha^q, \alpha^{q^2},..., \alpha^{q^{n-1}}\}$ отличается от случая базиса второго типа.
Допустим противное, т.е.
$$\sum_{j=0}^{n-1}a_j\alpha^{q^j}=0$$
для некоторого ненулевого вектора $(\alpha_j)$ с координатами из поля $GF(q)$. Подставляя равенства
$$\alpha^{q^i} = \zeta^{q^i}+\zeta^{-q^i},$$
получаем, что 
$$\sum_{j=0}^{n-1}a_j(\zeta^{q^i}+\zeta^{-q^i})=0$$
Последнее равенство можно переписать в виде
$$\sum_{i=0}^{2n-1}b_i\zeta^i=0$$,
если определить $b_i$ как $a_j$, где $i=\pm q^j \mod p$ (как было указано выше, последнее условие определяет число $j$ однозначно; знак плюс соответствует
случаю, когда число $i$ - вычет, а знак минус - случаю, когда $i$ является квадратичным невычетом по модулю $p$), значит многочлен 
$$f(X)=\sum_{i=0}^{2n-1}b_iX^i$$
имеет корни $\zeta$ и $\zeta^{-1}$ в поле $GF(q^{2n})$, а так как эти элементы имеют минимальные многочлены степени $n$ каждый, причем они взаимно просты
(в указанном поле корнями первого из них являются $\zeta^{q^i}, i=0,...,n-1$, а корнями второго - элементы $\zeta^{-q^i}, i=0,...,n-1$), то многочлен 
$f(X)$ над полем $GF(q)$ должен делиться на их произведение, что невозможно, так как его степень меньше $2n$.

Проверка оптимальности построенного базиса почти ничем не отличается от второго случая. Достаточно проверить, что при $k<n$
$$1 + q^k = \pm q^{\sigma(k+1)}\mod p$$ и $$1-q^k=\pm q^{\mu(k)}\mod p$$
(в последнем случае только при $k>0$), тогда 
$$\zeta^{1 + q^k} + \zeta^{-1 - q^k} = \zeta^{q^{\sigma(k+1)}} + \zeta^{-q^{\sigma(k+1)}} = \alpha^{q^{\sigma(k+1)}},$$
$$\zeta^{1 - q^k} + \zeta^{-1 + q^k} = \zeta^{q^{\mu(k)}} + \zeta^{-q^{\mu(k)}} = \alpha^{q^{\mu(k)}}, k>0.$$

Так же, как и в случае второго типа, при $n>k>0$ имеем
\begin{align}
\alpha\alpha^{q^k} = (\zeta + \zeta^{-1})(\zeta^{q^k} + \zeta^{-q^k}) = \zeta^{1 + q^k} + \zeta^{-1 - q^k} + \zeta^{1 - q^k} + \zeta^{-1 + q^k} =\nonumber\\
=\alpha^{q^{\sigma(k+1)}} + \alpha^{q^{\mu(k)}},\nonumber
\end{align}
а при $k=0$ 
\begin{align}
\alpha\alpha^{q^0} = \zeta^{1 + q^0} + \zeta^{-1 - q^0} + \zeta^{1 - q^0} + \zeta^{-1 + q^0} = \zeta^{1 + q^0} + \zeta^{-1 - q^0} + \zeta^0 + \zeta^0 =\nonumber\\ 
=\zeta^{1 + q^0} + \zeta^{-1 - q^0} = \alpha^{q^{\sigma(1)}}.\nonumber  
\end{align}

\subsubsection{Вычисление матрицы $T$.}
Как и в случае второго типа, выписывая равенства 
$$\alpha\alpha^{q^i}=\sum_{j=0}^{n-1}t_{i,j}\alpha^{q^j}$$
и сравнивая их с полученными равенствами
$$\alpha\alpha^{q^i} = \alpha^{q^{\sigma(i+1)}}+\alpha^{q^{\mu(i)}}, i>0, \alpha\alpha^{q^0}=\alpha^{q^{\sigma(1)}},$$
имеем
$$t_{i,j}=\delta_{\sigma(t+1),j}+\delta_{\mu(i),j}, i\ne0, t_{0,j}=\delta_{\sigma(1),j},$$
где $\delta_{k,s}$ - дельта-символ Кронекера.

Отметим, что в случае базиса третьего типа матрицы $T$ и $A$ идентичны.

\section{Вычисление обратного элемента в поле $GF(2^n)$}
Чтобы найти обратный элемент в поле $GF(2^n)$, нужно выполнить следующие действия:
$$x^{-1} = x^{2^n-2} = (x^2)^{2^{n-1}-1}$$

Степень, в которую нужно возвести обращаемое число, линейно зависит от размера поля. Если в степень возводить наивным методом, то есть последовательно
получая степени $x, x^2, x^3,...,x^{2^{n-1}-1}$, то оценить общую сложность обращения можно следующим образом: 
пусть $M$ - сложность умножения в поле. Тогда обращение будет иметь сложность $O(n)M$. Но возведение в степень можно ускорить, используя
метод аддитивных цепочек(метод Брауэра) \cite{gashkov1}. В худшем случае при использовании этого метода
сложность возведения в степень будет равна $\log_2 n (S + M)$, где $S$ - сложность возведения в квадрат, $M$ - сложность умножения. 

С учетом того, что в ОНБ $S = O(n)$, а $M = O(n^2)$, обращение в ОНБ будет иметь сложность $O(n^2 \log_2 n)$.
В стандартном базисе $S = M = O(n \log_2^3 n)$, следовательно обращение в стандартном базисе будет иметь сложность $O(n \log_2^4 n)$.
 